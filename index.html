
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>London Rent Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5.collide2d"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      
    <link rel="stylesheet" href="style.css">


    <script src="sketch.js"></script>
    <script src="sketch2.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  
  </head>
  <body>

<!-- part1 -->
  <div id="character">
    <img src="img/main.png"  alt="character" style="width: 200%;max-width: none;">
    <img src="img/1-1-1.png" class="float-image img1 group1" />
    <img src="img/1-1-2.png" class="float-image img2 group1" />
    <img src="img/1-1-3.png" class="float-image img3 group1" />

    <img src="img/1-2-1.png" class="float-image img4 group2" />
    <!-- <img src="img/1-2-1-2.png" class="float-image img4-2 group2" /> -->
    <img src="img/1-2-1-2.png" class="float-image img5 group2" />
    <img src="img/1-2-3.png" class="float-image img6 group2" />
  </div>

  


  <section class="section chat" id="bubble1" >
    <div class="bubble chat-block">Her name is Sophie.</div>
  </section>

  <section class="section chat" id="bubble2">
    <div class="bubble chat-block">She is not a loser.</div>
  </section>

  <section class="section chat" id="bubble3">
    <div class="bubble chat-block">She did everything she should do</div>
  </section>

  <section class="section chat" id="bubble4">
    <div class="bubble chat-block">She grew up in the suburbs. Her family was not wealthy and her parents had a tense relationship</div>
  </section>

  <section class="section chat" id="bubble5">
    <div class="bubble chat-block">She was admitted to a good university.<br> I have stable grades and am striving to apply for scholarships</div>
  </section>

  <section class="section chat" id="bubble6">
    <div class="bubble chat-block">Working during the summer vacation didn't delay the thesis either</div>
  </section>

  <section class="section chat" id="bubble7">
    <div class="bubble chat-block">She was recruited by a company in London after graduation</div>
  </section>

  <section class="section chat" id="bubble8">
    <div class="bubble chat-block">A job as a UX designer of her dreams</div>
  </section>

  <section class="section chat" id="bubble9">
    <div class="bubble chat-block">The salary is not high, but it's much better than that in my hometown</div>
  </section>

  <section class="section chat" id="bubble10">
    <div class="bubble chat-block">Now, there is only one question left: Where is she going to live</div>
  </section>
    
  <script>
  gsap.registerPlugin(ScrollTrigger);

  gsap.to("#character", {
    opacity: 1,
    y: 0,
    duration: 0.5,
    ease: "power2.out",
    scrollTrigger: {
      trigger: "#bubble1",
      start: "top center",   // bubble1 进入中部开始
      toggleActions: "play none none reverse"
    }
  });

  // 角色淡出：bubble3 结束时
  gsap.to("#character", {
    opacity: 0,
    y: -50,
    duration: 0.8,
    ease: "power2.out",
    scrollTrigger: {
      trigger: "#bubble10",
      start: "bottom center",   // bubble3 底部到达中心时开始隐藏
      toggleActions: "play none none reverse"
    }
  });

  // 控制气泡逐句出现
  document.querySelectorAll(".bubble").forEach((el) => {
    gsap.to(el, {
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: "power2.out",
      scrollTrigger: {
        trigger: el,
        start: "top 80%",
        toggleActions: "play none none reverse"
      }
    });
  });
  
  // 显示 png1（bubble4）
  ScrollTrigger.create({
    trigger: "#bubble4",
    start: "top center",
    onEnter: () => document.querySelector(".img1").classList.add("show"),
    onLeaveBack: () => document.querySelector(".img1").classList.remove("show")
  });

  // 显示 png2（bubble5）
  ScrollTrigger.create({
    trigger: "#bubble5",
    start: "top center",
    onEnter: () => document.querySelector(".img2").classList.add("show"),
    onLeaveBack: () => document.querySelector(".img2").classList.remove("show")
  });

  // 显示 png3（bubble6）
  ScrollTrigger.create({
    trigger: "#bubble6",
    start: "top center",
    onEnter: () => document.querySelector(".img3").classList.add("show"),
    onLeaveBack: () => document.querySelector(".img3").classList.remove("show")
  });

  // bubble6 离开时全部隐藏
  ScrollTrigger.create({
    trigger: "#bubble6",
    start: "bottom 90%",
    onLeave: () => {
      document.querySelectorAll(".group1").forEach(el => el.classList.remove("show"));
    }
  });
  //--------------
  // 显示 png4（bubble7）
  ScrollTrigger.create({
    trigger: "#bubble7",
    start: "top center",
    onEnter: () => document.querySelector(".img4").classList.add("show"),
    onLeaveBack: () => document.querySelector(".img4").classList.remove("show")
  });

  // 显示 png5（bubble8）
  ScrollTrigger.create({
    trigger: "#bubble8",
    start: "top center",
    onEnter: () => document.querySelector(".img5").classList.add("show"),
    onLeaveBack: () => document.querySelector(".img5").classList.remove("show")
  });

  // 显示 png6（bubble9）
  ScrollTrigger.create({
    trigger: "#bubble9",
    start: "top center",
    onEnter: () => document.querySelector(".img6").classList.add("show"),
    onLeaveBack: () => document.querySelector(".img6").classList.remove("show")
  });

  // bubble9 离开时全部隐藏
  ScrollTrigger.create({
    trigger: "#bubble9",
    start: "bottom bottom",
    onLeave: () => {
      document.querySelectorAll(".group2").forEach(el => el.classList.remove("show"));
    }
  });
  </script>


<!-- part2 -->
<section class="section">
  <section class="chat" id="bubble2-1">
    <div class="bubble chat-block">She opened the rental platform and saw that the prices were densely distributed on the map</div>

  </section>
  
  <div id="map-container">
    <div id="map"></div>
      <div style="font-size: 20px;"><br><br><br><br>This chart shows the median monthly rent of single-person apartments in different areas of London
        (Data source:https://www.gov.uk/government/statistics/private-rental-market-statistics)。
      It can be seen that even in areas outside Zone 3, the rent is much higher than 30% of Sophie's monthly income. This is a commonly recognized "rent burden warning line".
      The varying shades of color in the picture emphasize the gap between income and rent, revealing that "unaffordable rent" is not merely a feeling but a fact excluded by systematic pricing.</div>
  </div>
</section>

  <script>  
    // 地图map-container
    mapboxgl.accessToken = 'pk.eyJ1IjoicWFxb3ZvcXdxIiwiYSI6ImNtYmJqeXFwZzEyMG4ybHF1Z2xsNDFrM3IifQ.XWIUqmjrfxNA8rYM_x1yfg';
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v11',
      center: [-0.1, 51.5],
      zoom: 9,
      pitch: 0,
      bearing: 0
    });
map.on('load', () => {
  
    map.scrollZoom.disable();

    
      map.addSource('rent', {
        type: 'geojson',
        data: 'london_rent_2025_merged.geojson'
      });

      map.addLayer({
        id: '3d-rent',
        type: 'fill-extrusion',
        source: 'rent',
        paint: {
          'fill-extrusion-color': [
            'interpolate',
            ['linear'],
            ['get', 'rent'],
            1000, '#99D0D9',
            3000, '#4D6782'
          ],
          'fill-extrusion-height': ['get', 'rent'],
          'fill-extrusion-opacity': 0.9
        }
      });
      });

      // 使用 GSAP ScrollTrigger 控制 pitch 变化
      gsap.registerPlugin(ScrollTrigger);
      gsap.to(map, {
        pitch: 60,
        zoom: 10,
        scrollTrigger: {
          trigger: "#map-container",
          start: "top center",
          end: "bottom center",
          scrub: true
        },
        onUpdate: () => {
          map.setPitch(map.pitch);
        }
      });
    
  </script>

  <!-- part3 -->
  <section class="section chat" id="bubble3-1">
    <div class="bubble chat-block">Her income is £1,850 per month, and she spends at most 30% of it on rent</div>
    <div class="bubble chat-block">So she considered living further away so that she could afford it</div>
  </section>



  <section id="city-scene">

    <div class="buildings top-layer">
      <img src="img/3-left-top.png" class="building building-left-top building-left" />
      <img src="img/3-right-top.png" class="building building-right-top building-right" />
    </div>

    <div id="girl-container">
      <img src="img/3-main.png" id="girl" />
    </div>

    <div class="buildings bottom-layer">
      <img src="img/3-left-bottom.png" class="building building-bottom-left building-left" />
      <img src="img/3-right-bottom.png" class="building building-bottom-right building-right" />
    </div>
  

  </section>


  
  
  <script>
    // 初始偏移（x, y 不同方向）
    gsap.set(".building-left-top",     { x: -300, y: 0 });
    gsap.set(".building-right-top",    { x: 300, y: 0 });
    gsap.set(".building-bottom-left",  { x: -300, y: 300 });
    gsap.set(".building-bottom-right", { x: 300, y: 300 });

    // 当进入场景时 → 全部飞入中心（x:0, y:0）
    ScrollTrigger.create({
      trigger: "#city-scene",
      start: "top center",
      end: "bottom center",
      onEnter: () => {
        gsap.to(".building-left-top",     { x: 0, y: 0, opacity: 1, duration: 1 });
        gsap.to(".building-right-top",    { x: 0, y: 0, opacity: 1, duration: 1 });
        gsap.to(".building-bottom-left",  { x: 0, y: 0, opacity: 1, duration: 1 });
        gsap.to(".building-bottom-right", { x: 0, y: 0, opacity: 1, duration: 1 });
      },
      onLeaveBack: () => {
        gsap.to(".building", { opacity: 0 });
      }
    });

  </script>

  <!-- part4 -->


  <section class="chat" id="bubble4-1">
    <div class="bubble chat-block">What is the cost?<br>Commuting for 2 hours every day, taking the subway and feeling lonely</div>
  </section>


  <div id="map-frame" style="position: relative; width: 600px; height: 600px; margin: 100px auto; transform-origin: center center;">
    <div id="map2" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;"></div>
    <div id="frame-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 8px solid white; z-index: 1; pointer-events: none;"></div>
    <canvas id="circle-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none;"></canvas>
    <img id="center-photo" src="img/4-2-2.png" >
    <img id="center-bubble4-2" src="img/bubble4-2-1.png" >
    <img id="center-bubble4-3" src="img/bubble4-2-2.png" >
    </div>
    <div class="text-center-box">The circles in the figure visualize the average commuting distances of different areas in London
      (Data source:Travel to work, England and Wales Census 2021)。
  It can be seen that although the rent in the city center area is expensive, 
  the commuting time is relatively short. In the peripheral areas with slightly lower rents, the commuting time has increased sharply.
This further explains the realistic choice Sophie is facing: she can afford to live in a house far from the city center, 
but at the cost of a high-intensity daily commute - which will erode her time, energy and quality of life, and most of her time each day is spent on transportation.</div>


  <section id="bubble4-2">
    <div class="chat-block"></div>
  </section>


<script>
  // 设置你的 Mapbox token
  mapboxgl.accessToken = 'pk.eyJ1IjoicWFxb3ZvcXdxIiwiYSI6ImNtYmJqeXFwZzEyMG4ybHF1Z2xsNDFrM3IifQ.XWIUqmjrfxNA8rYM_x1yfg';

  const map2 = new mapboxgl.Map({
    container: 'map2',
    style: 'mapbox://styles/mapbox/light-v10',
    center: [-0.1, 51.5],
    zoom: 9
  });
  // 禁用缩放和交互功能
  map2.scrollZoom.disable();      // 禁止滚轮缩放
  map2.doubleClickZoom.disable(); // 禁止双击缩放
  map2.boxZoom.disable();         // 禁止框选缩放
  map2.dragRotate.disable();      // 禁止旋转
  map2.touchZoomRotate.disable(); // 禁止触控缩放
  map2.dragPan.disable();         // 禁止拖拽移动（可选）


  // 等待地图加载完成
  map2.on('load', () => {
    // 加载 rent geojson
    fetch('london_rent_2025_one_bed.json')
      .then(res => res.json())
      .then(rentData => {
        fetch('london_rent_2025_merged.geojson')
          .then(res => res.json())
          .then(geojson => {
            // 合并租金数据
            geojson.features.forEach(feature => {
              const name = feature.properties.name;
              feature.properties.rent = rentData[name] || 0;
            });

            map2.addSource('rent', {
              type: 'geojson',
              data: geojson
            });

            map2.addLayer({
              id: 'rent-fill',
              type: 'fill',
              source: 'rent',
              paint: {
                'fill-color': [
                  'interpolate',
                  ['linear'],
                  ['get', 'rent'],
                  1000, '#f1eef6',
                  1500, '#d4b9da',
                  2000, '#c994c7',
                  2500, '#df65b0',
                  3000, '#e7298a',
                  3500, '#ce1256'
                ],
                'fill-opacity': 0.7
              }
            });

            map2.addLayer({
              id: 'rent-outline',
              type: 'line',
              source: 'rent',
              paint: {
                'line-color': '#ffffff',
                'line-width': 1
              }
            });
          });
      });
  });
</script>

<script>
  const canvas = document.getElementById('circle-canvas');
  const ctx = canvas.getContext('2d');

  function resizeCanvas() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }

  resizeCanvas();
  window.addEventListener('resize', () => {
    resizeCanvas();
    drawCircles(); // 重绘
  });

  const circles = [];
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const colors = ['#ffffb2', '#fecc5c', '#fd8d3c', '#f03b20', '#bd0026', '#800026'];

  const maxRadius = Math.min(canvas.width, canvas.height) * 0.4; // 控制圆心区域半径

  for (let i = 0; i < 80; i++) {
    // 随机角度与半径，保证均匀分布在中心区域
    const angle = Math.random() * Math.PI * 2;
    const radiusFromCenter = Math.random() * maxRadius;

    const x = centerX + radiusFromCenter * Math.cos(angle);
    const y = centerY + radiusFromCenter * Math.sin(angle);

    const distRatio = radiusFromCenter / maxRadius; // 0 到 1

    const radius = 5 + distRatio * 20;
    const colorIndex = Math.min(Math.floor(distRatio * 6), 5);

    circles.push({ x, y, radius, color: colors[colorIndex] });
  }

  function drawCircles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (const circle of circles) {
      ctx.beginPath();
      ctx.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2);
      ctx.fillStyle = circle.color;
      ctx.fill();
    }
  }

  drawCircles();

    gsap.registerPlugin(ScrollTrigger);

  gsap.to("#map-frame", {
  scale: 20,
  ease: "none",
  scrollTrigger: {
    trigger: "#map-frame",
    start: "center center",
    endTrigger: "#bubble4-2",
    end: "top center",
    scrub: true,
    pin: "#map-frame",
    pinSpacing: true,
    onEnter: () => map2.resize(),
    onUpdate: () => map2.resize(),
    onLeave: () => {
      map2.resize();
      gsap.to("#map-frame", {
        opacity: 0,
        duration: 1,
        ease: "power2.out"
      });
    },
    onLeaveBack: () => {
      // 如果用户往回滚，重新显示 map-frame
      gsap.to("#map-frame", {
        opacity: 1,
        duration: 0.5
      });
    }
  }
});
</script>

<!-- part5 -->
  <section class="section chat" id="bubble5-1">
    <div class="bubble chat-block">So she looked up more and found that the income in those places with the highest rent remained unchanged all year round</div>
  </section>
  <div id="chart5-2" ></div>

  <div class="text-center-box">This chart shows the growth trends of the median rent and median wage in London from 2013 to 2019(Data source:https://www.ons.gov.uk/)。
  The line graph clearly shows that the increase rate of rent is greater than that of wages. Even though wages increase slightly every year, 
  rents are pushing people away from the city center at a faster rate.
  Sophie began to understand that the housing crisis was not a matter of personal choice, but rather a tilt in resource allocation under systematic design.</div>



  <script>
    const chartDom = document.getElementById('chart5-2');
    const myChart = echarts.init(chartDom);

    const option = {
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        data: ['Rent（£）', 'Salary（£）']
      },
      xAxis: {
        type: 'category',
        data: ['2013','2014','2015','2016','2017','2018','2019']
      },
      yAxis: {
        type: 'value'
      },
      series: [
        {
          name: 'rent（£）',
          type: 'line',
          data: [1668, 1798, 1928, 2102, 2058, 1925, 2210],
          smooth: true,
          lineStyle: {
            width: 5
          }
        },
        {
          name: 'salary（£）',
          type: 'line',
          data: [3808, 3850, 3875, 3900, 3925, 3950, 3967],
          smooth: true,
          lineStyle: {
            width: 5
          }
        }
      ]
    };

    myChart.setOption(option);
  </script>

<!-- part6 -->

<!-- part7 -->
  <section class="section chat" id="bubble5-1">
    <div class="bubble chat-block">The increase in population has also increased the demand for houses</div>
  </section>

  <div class="section" >
    <canvas id="populationChart" style="width: 100%; max-width: 900px; height: auto;"></canvas>
  </div>

  <div class="text-center-box">Apart from economic pressure, the urban population structure and housing policies are also the deep-seated causes of the problem. 
  With the growth of London's population, especially the continuous influx of immigrants (including some illegal residents), 
  the imbalance between urban infrastructure and housing supply has become increasingly serious (Data source: https://data.london.gov.uk/demography/).
Meanwhile, this contrasts sharply with the average wage growth rate in London over the past 7 years. 
The salaries earned by the public are not sufficient to balance their lives and those in the workplace.
Sophie is no longer just a girl who can't find a place to live. Behind her predicament, a city logic that intensifies exclusivity is quietly at work.</div>



<script>
    const populationCtx = document.getElementById('populationChart').getContext('2d');
    const populationChart = new Chart(populationCtx, {
        type: 'line',
        data: {
            labels: [2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022],
            datasets: [{
                label: 'Total population',
                data: [58892514, 59182170, 59456123, 59724394, 59988692, 60268457, 60609153, 61011788, 61507608, 62041708, 62759456, 63285145, 63710843, 64138721, 64619493, 65088058, 65607141, 65965992, 66288927, 66630707, 66744067, 66983488, 67603461],
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: true,
                tension: 0.3,
                pointRadius: 3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'The population growth trend of the United Kingdom from 2000 to 2022'
                }
            },
            scales: {
                y: {
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString();
                        }
                    }
                }
            }
        }
    });
</script>
<div style="height: 50vh;"></div><!--半页空白-->
<!-- part8 -->

<section class="section" id="bubble8-1">
  <div class="image-container">
    <img src="img/8-1.png" class="bg-image" />
    <div class="bubble-overlay">
      I began to realize that the problem was not just that I couldn't find a house,<br>but that cities were no longer designed for people like us
    </div>
  </div>
</section>

<!-- final -->


<!-- --------------------------------------------- -->
  <script> 
  //气泡渐隐效果
  gsap.utils.toArray(".chat-block").forEach((block) => {
    gsap.to(block, {
      opacity: 1,
      ease: "none",
      scrollTrigger: {
        trigger: block,
        start: "top 80%",      // 进入视口底部时开始出现
        end: "top 30%",        // 滚到视口上方 30% 时开始淡出
        scrub: true,           // 滚动时同步动画
        onLeave: () => gsap.to(block, { opacity: 0 }),
        onEnterBack: () => gsap.to(block, { opacity: 1 }),
        onLeaveBack: () => gsap.to(block, { opacity: 0 })
        }
    });
  });
  </script>


<!-- --------------------------------------------- -->
<!-- 淡入淡出动画 -->
<script>
  gsap.registerPlugin(ScrollTrigger);

  gsap.utils.toArray(".fade-text").forEach((elem) => {
    gsap.fromTo(
      elem,
      { opacity: 0, y: 30 },
      {
        opacity: 1,
        y: 0,
        duration: 1,
        ease: "power2.out",
        scrollTrigger: {
          trigger: elem,
          start: "top 80%",
          end: "top 20%",
          toggleActions: "play reverse play reverse",
        },
      }
    );
  });
</script>

<!-- step 激活高亮 -->
<script>
  const steps = document.querySelectorAll(".step");

  const stepObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        steps.forEach(step => step.classList.remove("is-active"));
        entry.target.classList.add("is-active");
      }
    });
  }, { threshold: 0.5 });

  steps.forEach(step => stepObserver.observe(step));
</script>



<div style="height: 50vh;"></div><!--半页空白-->
    
  </body>
</html>
